<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.page.companypage.managemember.ManageMemberMapper">

<resultMap type="kr.or.ddit.vo.MemberVO" id="memberMap">
<result property="memId" column="MEM_ID"/>
<result property="departNo" column="DEPART_NO"/>
<result property="memPw" column="MEM_PW"/>
<result property="memEnable" column="MEM_ENABLE"/>
<result property="memName" column="MEM_NAME"/>
<result property="memGender" column="MEM_GENDER"/>
<result property="memRegDate" column="MEM_REG_DATE"/>
<result property="memEmail" column="MEM_EMAIL"/>
<result property="memTel" column="MEM_TEL"/>
<result property="memBir" column="MEM_BIR"/>
<result property="posNo" column="POS_NO"/>
<result property="fileGroupNo" column="FILE_GROUP_NO"/>
		<association property="fileGroupVO" resultMap="fileGroupMap"></association>
	</resultMap>

<!-- 파일그룹 : 파일상세 = 1 : N -->
	<resultMap type="kr.or.ddit.vo.FileGroupVO" id="fileGroupMap">
		<result property="fileGroupNo" column="FILE_GROUP_NO"/>
		<result property="fileRegdate" column="FILE_REGDATE"/>
		<collection property="fileDetailVOList" resultMap="fileDetailMap"></collection>
	</resultMap>

	<resultMap type="kr.or.ddit.vo.FileDetailVO" id="fileDetailMap">
		<result property="fileSn" column="FILE_SN"/>
		<result property="fileGroupNo" column="FILE_GROUP_NO"/>
		<result property="fileOriginalName" column="FILE_ORIGINAL_NAME"/>
		<result property="fileSaveName" column="FILE_SAVE_NAME"/>
		<result property="fileSaveLocate" column="FILE_SAVE_LOCATE"/>
		<result property="fileSize" column="FILE_SIZE"/>
		<result property="fileExt" column="FILE_EXT"/>
		<result property="fileMime" column="FILE_MIME"/>
		<result property="fileFancysize" column="FILE_FANCYSIZE"/>
		<result property="fileSaveDate" column="FILE_SAVE_DATE"/>
		<result property="fileDowncount" column="FILE_DOWNCOUNT"/>
	</resultMap>
	
	<sql id="where">
    <if test="keyword != null and keyword != ''">
        AND (MEM_NAME LIKE '%' || #{keyword} || '%' OR MEM_ID LIKE '%' || #{keyword} || '%')
    </if>
</sql>
<select id="getTotal" parameterType="hashMap" resultType="int">
        SELECT COUNT(*) FROM MEMBER
        WHERE 1 = 1
        <include refid="where"/>
    </select>
	
	<select id="list" parameterType="hashMap" resultType="kr.or.ddit.vo.MemberVO">
    SELECT T.RNUM, T.MEM_ID, T.MEM_NAME, T.MEM_TEL,T.MEM_ENABLE, T.MEM_BIR, T.MEM_EMAIL, T.MEM_REG_DATE
    FROM (
        SELECT ROW_NUMBER() OVER (ORDER BY MEM_REG_DATE DESC) RNUM,  <!-- 가입 날짜 기준 내림차순 정렬 -->
               MEM_ID, MEM_NAME, MEM_TEL,MEM_ENABLE, TO_CHAR(MEM_BIR, 'yyyy-mm-dd') MEM_BIR, MEM_EMAIL,
               TO_CHAR(MEM_REG_DATE, 'yyyy-mm-dd') MEM_REG_DATE
        FROM MEMBER
        WHERE 1 = 1
        <include refid="where"/>
    ) T
    WHERE T.RNUM BETWEEN (#{currentPage} * 10) - (10 - 1) AND (#{currentPage} * 10)
</select>
	
 <!-- 모든 회원 조회 -->
    <select id="selectAllMembers" resultType="kr.or.ddit.vo.MemberVO">
        SELECT * FROM MEMBER
    </select>

    <!-- 회원 정보 수정 -->
    <update id="updateMember" parameterType="kr.or.ddit.vo.MemberVO">
        UPDATE MEMBER
        SET MEM_NAME = #{memName},
            MEM_TEL = #{memTel},
            MEM_EMAIL = #{memEmail},
            MEM_ENABLE = #{memEable},
            POS_NO = #{posNo}
        WHERE MEM_ID = #{memId}
    </update>
    <!-- 회원 탈퇴 처리 -->
		
		<update id="updateMemberEnable" parameterType="kr.or.ddit.vo.MemberVO">
    UPDATE MEMBER
    SET MEM_ENABLE = 'n'
    WHERE MEM_ID = #{memId} AND MEM_ENABLE = 'y'
</update>
		
    <!-- 회원 삭제 -->
    <delete id="deleteMember" parameterType="kr.or.ddit.vo.MemberVO">
        DELETE FROM MEMBER
        WHERE MEM_ID = #{memId}
    </delete>
</mapper>
