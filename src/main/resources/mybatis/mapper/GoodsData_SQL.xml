<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.page.companypage.manageshop.GoodsDataMapper">

    <!-- ‚úÖ 1. Ï†ÑÏ≤¥ Îß§Ï∂ú (ÏõîÎ≥Ñ) -->
    <select id="getTotalSalesByMonth" resultType="map">
        SELECT 
            TO_CHAR(OI.ORDER_DATE, 'YYYY-MM') AS month,
            SUM(OL.ORDER_LIST_QY * G.GDS_PRICE) AS totalSales
        FROM ORDER_INFO OI
        JOIN ORDER_LIST OL ON OI.ORDER_NO = OL.ORDER_NO
        JOIN GOODS G ON OL.GDS_NO = G.GDS_NO
        GROUP BY TO_CHAR(OI.ORDER_DATE, 'YYYY-MM')
        ORDER BY month
    </select>

    <!-- ‚úÖ 2. Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Îß§Ï∂ú (categoryNo Ï∂îÍ∞Ä) -->
    <select id="getSalesByCategory" resultType="map">
        SELECT 
            GC.GDS_CTGRY_NO AS categoryNo,  <!-- üìå categoryNo Ï∂îÍ∞Ä -->
            GC.GDS_CTGRY_NM AS categoryName,
            SUM(OL.ORDER_LIST_QY * G.GDS_PRICE) AS totalSales
        FROM ORDER_LIST OL
        JOIN GOODS G ON OL.GDS_NO = G.GDS_NO
        JOIN GDS_CTGRY GC ON G.CTGRY_NO = GC.GDS_CTGRY_NO
        GROUP BY GC.GDS_CTGRY_NO, GC.GDS_CTGRY_NM  <!-- üìå categoryNo Ï∂îÍ∞Ä -->
        ORDER BY totalSales DESC
    </select>

    <!-- ‚úÖ 3. Í∑∏Î£πÎ≥Ñ Îß§Ï∂ú (groupNo Ï∂îÍ∞Ä) -->
    <select id="getSalesByGroup" resultType="map">
        SELECT 
            GP.GROUP_NO AS groupNo,  <!-- üìå groupNo Ï∂îÍ∞Ä -->
            GP.GROUP_NAME AS groupName,
            SUM(OL.ORDER_LIST_QY * G.GDS_PRICE) AS totalSales
        FROM ORDER_LIST OL
        JOIN GOODS G ON OL.GDS_NO = G.GDS_NO
        JOIN GROUPS GP ON G.GROUP_NO = GP.GROUP_NO
        GROUP BY GP.GROUP_NO, GP.GROUP_NAME  <!-- üìå groupNo Ï∂îÍ∞Ä -->
        ORDER BY totalSales DESC
    </select>

    <!-- ‚úÖ 4. ÌäπÏ†ï Í∑∏Î£π ÌÅ¥Î¶≠ ‚Üí ÏõîÎ≥Ñ Îß§Ï∂ú -->
    <select id="getGroupSalesByMonth" parameterType="int" resultType="map">
        SELECT 
            TO_CHAR(OI.ORDER_DATE, 'YYYY-MM') AS month,
            SUM(OL.ORDER_LIST_QY * G.GDS_PRICE) AS totalSales
        FROM ORDER_INFO OI
        JOIN ORDER_LIST OL ON OI.ORDER_NO = OL.ORDER_NO
        JOIN GOODS G ON OL.GDS_NO = G.GDS_NO
        WHERE G.GROUP_NO = #{groupNo}
        GROUP BY TO_CHAR(OI.ORDER_DATE, 'YYYY-MM')
        ORDER BY month
    </select>

    <!-- ‚úÖ 5. ÌäπÏ†ï Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÅ¥Î¶≠ ‚Üí ÏõîÎ≥Ñ Îß§Ï∂ú -->
    <select id="getCategorySalesByMonth" parameterType="int" resultType="map">
        SELECT 
            TO_CHAR(OI.ORDER_DATE, 'YYYY-MM') AS month,
            SUM(OL.ORDER_LIST_QY * G.GDS_PRICE) AS totalSales
        FROM ORDER_INFO OI
        JOIN ORDER_LIST OL ON OI.ORDER_NO = OL.ORDER_NO
        JOIN GOODS G ON OL.GDS_NO = G.GDS_NO
        WHERE G.CTGRY_NO = #{categoryNo}
        GROUP BY TO_CHAR(OI.ORDER_DATE, 'YYYY-MM')
        ORDER BY month
    </select>

    <!-- ‚úÖ 6. ÌäπÏ†ï ÍµøÏ¶à ÌÅ¥Î¶≠ ‚Üí ÏõîÎ≥Ñ Îß§Ï∂ú -->
    <select id="getGoodsSalesByMonth" parameterType="int" resultType="map">
        SELECT 
            TO_CHAR(OI.ORDER_DATE, 'YYYY-MM') AS month,
            SUM(OL.ORDER_LIST_QY * G.GDS_PRICE) AS totalSales
        FROM ORDER_INFO OI
        JOIN ORDER_LIST OL ON OI.ORDER_NO = OL.ORDER_NO
        JOIN GOODS G ON OL.GDS_NO = G.GDS_NO
        WHERE G.GDS_NO = #{gdsNo}
        GROUP BY TO_CHAR(OI.ORDER_DATE, 'YYYY-MM')
        ORDER BY month
    </select>

    <!-- ‚úÖ 7. Ï†ÑÏ≤¥ Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù -->
    <select id="getAllCategories" resultType="map">
    SELECT 
        GDS_CTGRY_NO AS ctgryNo,
        GDS_CTGRY_NM AS gdsCtgryNm
    FROM GDS_CTGRY
    ORDER BY ctgryNo ASC
</select>


    <!-- ‚úÖ 8. Ï†ÑÏ≤¥ Í∑∏Î£π Î™©Î°ù -->
    <select id="getAllGroups" resultType="map">
        SELECT 
            GROUP_NO AS groupNo,
            GROUP_NAME AS groupName
        FROM GROUPS
        ORDER BY groupNo ASC
    </select>


<!-- ‚úÖ 9. Ï†úÏùº ÎßéÏù¥ ÌåîÎ¶∞ Î¨ºÌíà TOP 10 -->
<select id="getTopSellingGoods" resultType="map">
    SELECT 
        G.GDS_NO AS gdsNo, 
        G.GDS_NM AS gdsName,  -- üìå ÏàòÏ†ïÎê®: GDS_NAME ‚Üí GDS_NM
        SUM(OL.ORDER_LIST_QY) AS totalQuantity,  
        SUM(OL.ORDER_LIST_QY * G.GDS_PRICE) AS totalSales  
    FROM ORDER_LIST OL
    JOIN GOODS G ON OL.GDS_NO = G.GDS_NO
    GROUP BY G.GDS_NO, G.GDS_NM  -- üìå ÏàòÏ†ïÎê®: GDS_NAME ‚Üí GDS_NM
    ORDER BY totalSales DESC  
    FETCH FIRST 10 ROWS ONLY  
</select>



<!-- ‚úÖ 10. ÌäπÏ†ï Í∏∞Í∞Ñ ÎÇ¥ Ï†úÏùº ÎßéÏù¥ ÌåîÎ¶∞ Î¨ºÌíà TOP 10 -->
<select id="getTopSellingGoodsByDate" parameterType="map" resultType="map">
    SELECT 
        G.GDS_NO AS gdsNo, 
        G.GDS_NM AS gdsName,  -- üìå ÏàòÏ†ïÎê®: GDS_NAME ‚Üí GDS_NM
        SUM(OL.ORDER_LIST_QY) AS totalQuantity,  
        SUM(OL.ORDER_LIST_QY * G.GDS_PRICE) AS totalSales  
    FROM ORDER_INFO OI
    JOIN ORDER_LIST OL ON OI.ORDER_NO = OL.ORDER_NO
    JOIN GOODS G ON OL.GDS_NO = G.GDS_NO
    WHERE OI.ORDER_DATE BETWEEN #{startDate} AND #{endDate}  
    GROUP BY G.GDS_NO, G.GDS_NM  -- üìå ÏàòÏ†ïÎê®: GDS_NAME ‚Üí GDS_NM
    ORDER BY totalSales DESC  
    FETCH FIRST 10 ROWS ONLY  
</select>

<!-- ‚úÖ ÌäπÏ†ï Ïπ¥ÌÖåÍ≥†Î¶¨ ÎÇ¥ ÌåêÎß§Ïú® ÎÜíÏùÄ 5Í∞ú ÏÉÅÌíà Ï°∞Ìöå (ÏàòÏ†ï ÏôÑÎ£å) -->
<select id="getTop5SellingGoodsInCategory" parameterType="int" resultType="map">
    SELECT 
    G.GDS_NO AS gdsNo, 
    G.GDS_NM AS gdsName,
    G.GDS_PRICE AS gdsPrice,
    SUM(OL.ORDER_LIST_QY) AS totalQuantity,
    SUM(OL.ORDER_LIST_QY * G.GDS_PRICE) AS totalSales
FROM ORDER_LIST OL
JOIN GOODS G ON OL.GDS_NO = G.GDS_NO
WHERE G.CTGRY_NO = #{categoryNo}  -- ÌäπÏ†ï Ïπ¥ÌÖåÍ≥†Î¶¨ ÎÇ¥ ÏÉÅÌíàÎßå Ï°∞Ìöå
GROUP BY G.GDS_NO, G.GDS_NM, G.GDS_PRICE
ORDER BY totalSales DESC  -- Ï¥ù Îß§Ï∂ú(ÏàòÏùµ) Í∏∞Ï§Ä Ï†ïÎ†¨
FETCH FIRST 5 ROWS ONLY  -- ÏÉÅÏúÑ 5Í∞ú ÏÉÅÌíàÎßå Ï°∞Ìöå

</select>



<!-- ‚úÖ 12. ÌäπÏ†ï Í∑∏Î£π ÎÇ¥ ÌåêÎß§Ïú® ÎÜíÏùÄ 5Í∞ú ÏÉÅÌíà Ï°∞Ìöå -->
<select id="getTop5SellingGoodsInGroup" parameterType="int" resultType="map">
    SELECT 
        G.GDS_NO AS gdsNo, 
        G.GDS_NM AS gdsName,
        SUM(OL.ORDER_LIST_QY) AS totalQuantity,
        SUM(OL.ORDER_LIST_QY * G.GDS_PRICE) AS totalSales
    FROM ORDER_LIST OL
    JOIN GOODS G ON OL.GDS_NO = G.GDS_NO
    WHERE G.GROUP_NO = #{groupNo}  -- ÌäπÏ†ï Í∑∏Î£π ÎÇ¥ ÏÉÅÌíàÎßå Ï°∞Ìöå
    GROUP BY G.GDS_NO, G.GDS_NM
    ORDER BY totalSales DESC  -- Ï¥ù Îß§Ï∂ú(ÏàòÏùµ) Í∏∞Ï§Ä Ï†ïÎ†¨
    FETCH FIRST 5 ROWS ONLY  -- ÏÉÅÏúÑ 5Í∞ú ÏÉÅÌíàÎßå Ï°∞Ìöå
</select>




</mapper>
