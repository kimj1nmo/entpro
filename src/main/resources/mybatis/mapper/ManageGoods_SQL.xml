<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.page.companypage.manageshop.ManageGoodsMapper">

<resultMap id="goodsMap" type="kr.or.ddit.vo.GoodsVO">
    <id property="gdsNo" column="gdsNo"/>
    <result property="ctgryNo" column="ctgryNo"/>
    <result property="gdsNm" column="gdsNm"/>
    <result property="gdsPrice" column="gdsPrice"/>
    <result property="fileGroupNo" column="fileGroupNo"/>
    <result property="gdsDc" column="gdsDc"/>
    <result property="memId" column="memId"/>
    <result property="gdsDate" column="gdsDate"/>


<!-- ‚úÖ GroupsVO Îß§Ìïë -->
    <association property="groups" javaType="kr.or.ddit.vo.GroupsVO">
        <result property="groupNo" column="groupNo"/>
        <result property="groupName" column="groupName"/>
    </association>

    <!-- ‚úÖ GdsCtgryVO Îß§Ìïë -->
    <association property="gdsCtgry" javaType="kr.or.ddit.vo.GdsCtgryVO">
        <result property="gdsCtgryNo" column="ctgryNo"/>
        <result property="gdsCtgryNm" column="gdsCtgryNm"/>
    </association>

    <!-- ‚úÖ Ïó¨Îü¨ Í∞úÏùò Ïù¥ÎØ∏ÏßÄ ÌååÏùºÏùÑ fileDetailVOListÏóê Îß§Ìïë -->
    <collection property="fileDetailVOList" ofType="kr.or.ddit.vo.FileDetailVO">
        <id property="fileSn" column="fileSn"/>
        <result property="fileOriginalName" column="fileOriginalName"/>
        <result property="fileSaveName" column="fileSaveName"/>
        <result property="fileSaveLocate" column="fileSaveLocate"/>
        <result property="fileSize" column="fileSize"/>
        <result property="fileExt" column="fileExt"/>
        <result property="fileMime" column="fileMime"/>
    </collection>
</resultMap>





<!-- ÌäπÏ†ï ÏÉÅÌíà Ï°∞Ìöå -->
<select id="getGoodsById" parameterType="int" resultType="kr.or.ddit.vo.GoodsVO">
    SELECT
        GDS_NO AS gdsNo,
        CTGRY_NO AS ctgryNo,
        GDS_NM AS gdsNm,
        GDS_PRICE AS gdsPrice,
        FILE_GROUP_NO AS fileGroupNo,
        GDS_DC AS gdsDc,
        MEM_ID AS memId,
        GDS_DATE AS gdsDate
    FROM GOODS
    WHERE GDS_NO = #{gdsNo}
</select>

 <!-- Í∞ÄÏû• ÎÜíÏùÄ GDS_NO Ï°∞Ìöå -->
<select id="getMaxGdsNo" resultType="int">
    SELECT MAX(GDS_NO) FROM GOODS
</select>

<!-- ÏÉÅÌíà Ï†ÑÏ≤¥ Ï°∞Ìöå -->
<select id="getAllGoods" resultMap="goodsMap">
    SELECT
    G.GDS_NO AS gdsNo,
    G.CTGRY_NO AS ctgryNo,
    G.GDS_NM AS gdsNm,
    G.GDS_PRICE AS gdsPrice,
    G.FILE_GROUP_NO AS fileGroupNo,
    G.GDS_DC AS gdsDc,
    G.MEM_ID AS memId,
    G.GDS_DATE AS gdsDate,
    G.GDSSTATUS AS gdsStatus,

    -- ‚úÖ GroupsVO Îß§ÌïëÏö©
    GP.GROUP_NO AS groupNo,
    NVL(GP.GROUP_NAME, 'No Group') AS groupName,

    -- ‚úÖ GdsCtgryVO Îß§ÌïëÏö©
    GC.GDS_CTGRY_NO AS gdsCtgryNo,
    NVL(GC.GDS_CTGRY_NM, 'No Category') AS gdsCtgryNm,

    -- ‚úÖ ÌååÏùº Ï†ïÎ≥¥
    FD.FILE_SN AS fileSn,
    FD.FILE_ORIGINAL_NAME AS fileOriginalName,
    FD.FILE_SAVE_NAME AS fileSaveName,
    FD.FILE_SAVE_LOCATE AS fileSaveLocate,
    FD.FILE_SIZE AS fileSize,
    FD.FILE_EXT AS fileExt,
    FD.FILE_MIME AS fileMime
FROM GOODS G
LEFT JOIN GROUPS GP ON G.GROUP_NO = GP.GROUP_NO  -- ‚úÖ GroupsVOÏö© Ï°∞Ïù∏
LEFT JOIN GDS_CTGRY GC ON G.CTGRY_NO = GC.GDS_CTGRY_NO -- ‚úÖ GdsCtgryVOÏö© Ï°∞Ïù∏
LEFT JOIN FILE_DETAIL FD ON G.FILE_GROUP_NO = FD.FILE_GROUP_NO -- ‚úÖ ÌååÏùº Ï°∞Ïù∏
ORDER BY G.GDS_NO

</select>




<!-- üìå GOODS ÌÖåÏù¥Î∏î Îç∞Ïù¥ÌÑ∞ ÏÇΩÏûÖ (FILE_GROUPÏùÄ Îî∞Î°ú ÏÉùÏÑ± ÌõÑ Ï†ÑÎã¨Î∞õÏùå) -->
    <insert id="insertGoods" parameterType="kr.or.ddit.vo.GoodsVO">
        INSERT INTO GOODS (
            GDS_NO, CTGRY_NO, GDS_NM, GDS_PRICE, FILE_GROUP_NO,
            GDS_DC, MEM_ID, GDS_DATE, GROUP_NO
        ) VALUES (
            SEQ_GOODS.NEXTVAL, #{ctgryNo}, #{gdsNm}, #{gdsPrice},
            #{fileGroupNo}, #{gdsDc}, #{memId}, SYSDATE, #{groupNo}
        )
    </insert>

    <update id="updateGoods" parameterType="kr.or.ddit.vo.GoodsVO">
    UPDATE GOODS
    SET
        CTGRY_NO = #{ctgryNo},
        GDS_NM = #{gdsNm},
        GDS_PRICE = #{gdsPrice},
        GDS_DC = #{gdsDc},
        MEM_ID = #{memId},
        GROUP_NO = #{groupNo},
        GDS_DATE = SYSDATE
        <if test="fileGroupNo != null">
            , FILE_GROUP_NO = #{fileGroupNo}
        </if>
    WHERE GDS_NO = #{gdsNo}
</update>

</mapper>
