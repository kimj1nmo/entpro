<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="kr.or.ddit.page.companypage.managevod.ManageVodMapper">


	<sql id="where">
		<if test="keyword!=null and keyword!=''">
			AND (
			GROUP_NAME LIKE '%' || #{keyword} || '%' OR
			GROUP_INTRCN LIKE '%' || #{keyword} || '%' OR
			FILE_GROUP_NO LIKE '%'
			|| #{keyword} || '%'
			)
		</if>
	</sql>

<resultMap type="kr.or.ddit.vo.LiveVO" id="liveMap">
		<result property="fileGroupNo" column="FILE_GROUP_NO" />
		<result property="sumFileGroupNo" column="SUM_FILE_GROUP_NO" />
		<result property="liveNo" column="LIVE_NO" />
		<result property="memshipState" column="MEMSHIP_STATE" />
		<result property="liveName" column="LIVE_NAME" />
		<result property="liveView" column="LIVE_VIEW" />
		<result property="liveDate" column="LIVE_DATE" />
		<result property="memId" column="MEM_ID" />
		<result property="liveStatus" column="LIVE_STATUS" />
		<result property="commRegNo" column="COMM_REG_NO" />
		<result property="commRegJoin" column="COMM_REG_JOIN" />
		<result property="commRegNick" column="COMM_REG_NICK" />
		<association property="fileGroupVO"
			resultMap="fileGroupMap"></association>
		<association property="vodVO"
			resultMap="vodMap"></association>
	</resultMap>

	<resultMap type="kr.or.ddit.vo.VodVO" id="vodMap">
		<result property="liveNo" column="LIVE_NO" />
		<result property="vodType" column="VOD_TYPE" />
		<result property="vodStatus" column="VOD_STATUS" />
		<result property="fileGroupNo" column="FILE_GROUP_NO" />
		<result property="vodNo" column="VOD_NO" />
		<result property="vodName" column="VOD_NAME" />
		<result property="memId" column="MEM_ID" />
		<result property="vodPlaytime" column="VOD_PLAYTIME" />
		<result property="vodView" column="VOD_VIEW" />
		<result property="vodPath" column="VOD_PATH" />
		<association property="fileGroupVO"
			resultMap="fileGroupMap"></association>

	</resultMap>

	<resultMap type="kr.or.ddit.vo.ArtistVO" id="artistMap">
		<result property="artistNo" column="ARTIST_NO" />
		<result property="artistName" column="ARTIST_NAME" />
		<result property="artistProfile" column="ARTIST_PROFILE" />
		<result property="artistBirth" column="ARTIST_BIRTH" />
		<result property="artistIntrcn" column="ARTIST_INTRCN" />
		<result property="memId" column="MEM_ID" />
		<result property="fileGroupNo" column="FILE_GROUP_NO" />
	</resultMap>


	<!-- 파일그룹 : 파일상세 = 1 : N -->
	<resultMap type="kr.or.ddit.vo.FileGroupVO" id="fileGroupMap">
		<result property="fileGroupNo" column="FILE_GROUP_NO" />
		<result property="fileRegdate" column="FILE_REGDATE" />
		<collection property="fileDetailVOList"
			resultMap="fileDetailMap"></collection>
	</resultMap>

	<resultMap type="kr.or.ddit.vo.FileDetailVO"
		id="fileDetailMap">
		<result property="fileSn" column="FILE_SN" />
		<result property="fileGroupNo" column="FILE_GROUP_NO" />
		<result property="fileOriginalName" column="FILE_ORIGINAL_NAME" />
		<result property="fileSaveName" column="FILE_SAVE_NAME" />
		<result property="fileSaveLocate" column="FILE_SAVE_LOCATE" />
		<result property="fileSize" column="FILE_SIZE" />
		<result property="fileExt" column="FILE_EXT" />
		<result property="fileMime" column="FILE_MIME" />
		<result property="fileFancysize" column="FILE_FANCYSIZE" />
		<result property="fileSaveDate" column="FILE_SAVE_DATE" />
		<result property="fileDowncount" column="FILE_DOWNCOUNT" />
	</resultMap>



	<!-- 총 페이지 수 -->
	<select id="getTotal" parameterType="hashMap" resultType="int">
		SELECT COUNT(*) FROM VOD
		<!-- <include refid="where"></include> -->
	</select>



	<select id="listSort" parameterType="hashMap" resultMap="vodMap">
		SELECT
		T.RNUM
		,T.VOD_NO, T.VOD_NAME, T.MEM_ID, T.VOD_PLAYTIME, T.VOD_VIEW,
		T.VOD_PATH
		, T.LIVE_NO, T.VOD_TYPE, T.VOD_STATUS, T.FILE_GROUP_NO
		, T.FILE_GROUP_NO
		, T.FILE_REGDATE, T.FILE_SN, T.FILE_ORIGINAL_NAME,
		T.FILE_SAVE_NAME
		,
		T.FILE_SAVE_LOCATE, T.FILE_SIZE,
		T.FILE_EXT,T.FILE_MIME
		,
		T.FILE_FANCYSIZE, T.FILE_SAVE_DATE,
		T.FILE_DOWNCOUNT
		FROM
		(
		SELECT
		ROW_NUMBER() OVER (
		<!-- <if test="sortName == 'vodNo'"> -->
		ORDER BY V.VOD_NO
		<!-- </if> -->
		<!-- <if test="sortName == 'groupName'"> -->
		<!-- ORDER BY G.GROUP_NAME -->
		<!-- </if> -->
		<!-- <if test="sortName == 'groupBirth'"> -->
		<!-- ORDER BY G.GROUP_BIRTH -->
		<!-- </if> -->
		<!-- <if test="sortName == 'groupDspgn'"> -->
		<!-- ORDER BY G.GROUP_DSPGN -->
		<!-- </if> -->
		<!-- <if test="mode == 0"> -->
		<!-- asc -->
		<!-- </if> -->
		<!-- <if test="mode == 1"> -->
		desc
		<!-- </if> -->
		)AS RNUM
		,V.VOD_NO, V.VOD_NAME, V.MEM_ID, V.VOD_PLAYTIME, V.VOD_VIEW, V.VOD_PATH
		, V.LIVE_NO, V.VOD_TYPE, V.VOD_STATUS, V.FILE_GROUP_NO

		,
		FG.FILE_REGDATE,
		FD.FILE_SN, FD.FILE_ORIGINAL_NAME, FD.FILE_SAVE_NAME
		,
		FD.FILE_SAVE_LOCATE, FD.FILE_SIZE, FD.FILE_EXT,FD.FILE_MIME
		,
		FD.FILE_FANCYSIZE, FD.FILE_SAVE_DATE, FD.FILE_DOWNCOUNT
		FROM VOD V

		LEFT
		OUTER JOIN FILE_GROUP FG ON V.FILE_GROUP_NO = FG.FILE_GROUP_NO
		LEFT
		OUTER JOIN FILE_DETAIL FD ON FG.FILE_GROUP_NO = FD.FILE_GROUP_NO
		WHERE
		1 = 1



		<if test="keyword!=null and keyword!=''">
			AND(
			 V.VOD_NAME LIKE '%' || #{keyword} || '%' OR
			 V.MEM_ID LIKE '%' || #{keyword} || '%'
			)
		</if>
		) T
		WHERE T.RNUM
		BETWEEN
		(#{currentPage} * 10) -
		(10 - 1) AND
		(#{currentPage} *
		10)
	</select>

<update id="updataStatus" parameterType="hashMap">
UPDATE VOD
SET VOD_STATUS = CASE
    WHEN VOD_STATUS = 1 THEN 0
    ELSE 1
END
WHERE VOD_NO = #{vodNo}
</update>
	<!-- 총 페이지 수 -->
	<select id="getLiveTotal" parameterType="hashMap" resultType="int">
		SELECT
		COUNT(*)
		FROM
		    live
		    where live_status =0
		    order by live_no
	</select>
<select id="liveList" parameterType="hashMap" resultMap="liveMap">

            SELECT
    L.LIVE_NO
  , L.MEMSHIP_STATE
  , L.LIVE_NAME
  , L.LIVE_VIEW
  , L.LIVE_DATE
  , L.MEM_ID
  , L.LIVE_STATUS
  , L.FILE_GROUP_NO
  , L.VOD_NO
  ,
		FG.FILE_REGDATE,
		FD.FILE_SN, FD.FILE_ORIGINAL_NAME, FD.FILE_SAVE_NAME
		,
		FD.FILE_SAVE_LOCATE, FD.FILE_SIZE, FD.FILE_EXT,FD.FILE_MIME
		,
		FD.FILE_FANCYSIZE, FD.FILE_SAVE_DATE, FD.FILE_DOWNCOUNT
FROM
    LIVE L
    LEFT
		OUTER JOIN FILE_GROUP FG ON L.FILE_GROUP_NO = FG.FILE_GROUP_NO
		LEFT
		OUTER JOIN FILE_DETAIL FD ON FG.FILE_GROUP_NO = FD.FILE_GROUP_NO
    WHERE L.LIVE_STATUS =0
    ORDER BY L.LIVE_NO

</select>
</mapper>





















