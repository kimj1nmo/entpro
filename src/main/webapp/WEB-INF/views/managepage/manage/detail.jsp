<%@ page language="java" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<!-- ///// header ÏãúÏûë ///// -->
<jsp:include page="../../include/header.jsp"></jsp:include>
<!-- ///// header ÎÅù ///// -->
<!-- ÏßÅÏ†ëÏ∂îÍ∞ÄÌïú CSS -->
<link href="/directlyCss/empCalendar.css" rel="stylesheet">

<script type="text/javascript" src="/js/jquery-3.6.0.js"></script>
<!-- sweetAlert -->
<link rel="stylesheet" href="/adminlte/plugins/sweetalert2/sweetalert2.min.css">
<script src="/adminlte/plugins/sweetalert2/sweetalert2.min.js"></script>

<!-- fullcalendar CDN -->
<!--   <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.css' rel='stylesheet' /> -->
<!--   <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.js'></script> -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<!-- fullcalendar Ïñ∏Ïñ¥ CDN -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/locales-all.min.js'></script>
<!-- axios -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
 
<div class="content-wrapper">
	<!--     Content Header (Page header) -->
	<div class="content-header">
		<div class="container-fluid">
			<div class="row mb-2">
				<div class="col-sm-6"></div>
				<!-- /.col -->
				<div class="col-sm-6">
					<ol class="breadcrumb float-sm-right">
						<li class="breadcrumb-item"><a href="/managepage/manage/list">ÌîÑÎ°úÏ†ùÌä∏ Î¶¨Ïä§Ìä∏</a></li>
						<li class="breadcrumb-item active">${projectVO.proTtl} ÌîÑÎ°úÏ†ùÌä∏</li>
					</ol>
				</div>
				<!-- /.col -->
			</div>
			<!-- /.row -->
		</div>
		<!-- /.container-fluid -->
	</div>
	<!--  /.content-header -->
<!-- ÏßÅÏ†ë Ï∂îÍ∞ÄÌïú CSS -->
<link rel="stylesheet" href="/directlyCss/project.css">
<link rel="stylesheet" href="/directlyCss/main.css">

<script type="text/javascript" src="/js/jquery-3.6.0.js"></script>
<script type="text/javascript">
$(function () {
  //ÌååÏùº Îã§Ïö¥Î°úÎìú
	$(document).on("click",".imgFileSaveLocate",function(){
		let fileSaveLocate = $(this).data("fileSaveLocate");// /resources/upload...
		//before : /resources/upload/project/Ïù¥ÎèôÍ¥ÄÎ¶¨Í≥ÑÌöç/82462b65-4b8f-4681-bce9-e3e260820079_dad.jpg
		//after  : /project/Ïù¥ÎèôÍ¥ÄÎ¶¨Í≥ÑÌöç/82462b65-4b8f-4681-bce9-e3e260820079_dad.jpg
		console.log("fileSaveLocate : " + fileSaveLocate);
		fileSaveLocate = fileSaveLocate.replaceAll("/resources/upload","");

		///download?fileName=/project/Ïù¥ÎèôÍ¥ÄÎ¶¨Í≥ÑÌöç/82462b65-4b8f-4681-bce9-e3e260820079_dad.jpg
		location.href="/download?fileName="+fileSaveLocate;
		
		return;
	});
  
  // ÎπÑÎèôÍ∏∞ ÏàòÏ†ï
  $("#btnUpdate").on("click", function(){
    let proNo = $("#proNo").val();
    let proTtl = $("#proTtl").val();
    let proManager = $("#proManager").val();
    let proRegDate = $("#proRegDate").val();
    let proDeadline = $("#proDeadline").val();
    let proComment = $("#proComment").val();

    let data = {
      "proNo" : proNo
      , "proTtl" : proTtl
      , "proManager" : proManager
      , "proRegDate" : proRegDate
      , "proDeadline" : proDeadline
      , "proComment" : proComment
    }
    console.log("updatePostAjax -> data : ", data);

    $.ajax({
        url:"/managepage/manage/updatePostAjax",
        contentType:"application/json;charset=utf-8",
        data:JSON.stringify(data),
        type:"post",
        dataType:"json",
        success:function(result){
          console.log("result : ", result);

          location.href = `/managepage/manage/detail/${proNo}`;
        }
    });
  });
  // ÏàòÏ†ïÎ™®Îìú
  $("#edit").on("click", function () {
    $("#div1").css("display", "none");
    $("#div2").css("display", "block");
    $(".ctrl").removeAttr("hidden");
    $(".ctrl").removeAttr("disabled");
    // $("#frm").attr("action", "/managepage/manage/updatePostAjax");
    $(".ctrl_p").css("display", "none");
    $("#prodId").attr("hidden", true);
  });
});
</script>

<!-- ///// content ÏãúÏûë ///// -->
<div class="d-flex justify-content-center align-items-center">
  <div class="callout callout-info col-md-6">
    <h2 style="text-align: center;">${projectVO.proTtl}</h2>
  </div>
</div>
<main id="detailPadding">
  <section class="content">
    <div class="container-fluid">
      <div class="row">
        <!-- ÏôºÏ™Ω 4Í∞úÏùò Ïπ¥Îìú -->
        <div class="col-md-8">
          <div class="row">
            <div class="col-md-6">
              <!-- Ï≤´ Î≤àÏß∏ Ïπ¥Îìú -->
              <div class="card card-primary durationHeight">
                <div class="card-header">
                  <h3 class="card-title">Í∑∏Î£π & ÏßÑÌñâÎ•†</h3>
                  <div class="card-tools">
                  </div>
                </div>
                <div class="card-body minHeight">
                  <!-- ÌîÑÎ°úÏ†ùÌä∏ ÏßÑÌñâ ÏàòÏπò ÏãúÏûë -->
                  <div class="col-lg-12 col-12">
										<div class="small-box bg-success d-flex align-items-center justify-content-center">
											<div class="inner">
												<h2>üéô&nbsp;${projectVO.groupName}</h2>
											</div>
										</div>
                    <!-- small card -->
                    <div id="durationFont" class="small-box bg-success" style="height: 40vh;">
                      <div class="inner text-center">
                        <h3 style="font-size: 150px;">${projectVO.percentage}<sup style="font-size: 30px">%</sup></h3>
        
                        <p class="durationFontSize">${projectVOList[0].proRegDate} ~ ${projectVOList[0].proDeadline}</p>
                      </div>
                      <div class="icon">
                        <i class="ion ion-stats-bars"></i>
                      </div>
                    </div>
                  </div>
                  <!-- ÌîÑÎ°úÏ†ùÌä∏ ÏßÑÌñâ ÏàòÏπò ÎÅù -->
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <!-- Îëê Î≤àÏß∏ Ïπ¥Îìú -->
              <div class="card card-primary minHeight">
                  <div class="card-header movePage" onclick="location.href = '/managepage/manage/gantt/${proNo}'">
                    <h3 class="card-title">ÏßÑÌñâÍ≤ΩÍ≥º</h3>
                    <i class="fas fa-plus" style="margin-left: auto;">&ensp;ÏÉÅÏÑ∏Ï†ïÎ≥¥</i>
                  </div>
                <!-- ÏßÑÌñâÍ≤ΩÍ≥º ÏãúÏûë -->
                <div class="col-md-12" style="max-height: 61.5vh; overflow: auto;">
                  <div class="card" style="min-height: 61.6vh;">
                    <!-- /.card-header -->
                    <c:forEach var="projectVO" items="${projectVOList}" varStatus="stat">
                      <c:if test="${projectVO.proYn == 1}">
		                    <div class="card-body">
		                      <h3 class="card-title">${projectVO.proJobNm}</h3><br>
		                      <h3 class="card-title">${projectVO.proStartDate} ~ ${projectVO.proEndDate}</h3><br>
		                      <div class="progress mb-3" id="progressContainer">
                            <span class="progress-text">${projectVO.gpercentage}%</span>
	                            <c:if test="${projectVO.gpercentage == 100}">
			                        <div class="progress-bar bg-success" style="width: ${projectVO.gpercentage}%">
			                        </div>
	                            </c:if>
	                            <c:if test="${projectVO.gpercentage != 100}">
			                        <div class="progress-bar bg-info" style="width: ${projectVO.gpercentage}%">
			                        </div>
	                            </c:if>
		                      </div>
		                    </div>
                      </c:if>
                  	</c:forEach>
                    <!-- /.card-body -->
                  </div>
                  <!-- /.card -->
                </div>
                <!-- ÏßÑÌñâÍ≤ΩÍ≥º ÎÅù -->  
              </div>
            </div>
            <div class="col-md-12">
              <!-- ÏÑ∏ Î≤àÏß∏ Ïπ¥Îìú -->
              <div class="card card-primary minHeight" >
                <div class="card-header movePage" onclick="location.href = '/managepage/manage/filebox/${proNo}'">
                  <h3 class="card-title">Í¥ÄÎ†® ÌååÏùºÌï®</h3>
                  <i class="fas fa-plus" style="margin-left: auto;">&ensp;ÏÉÅÏÑ∏Ï†ïÎ≥¥</i>
                  <!-- Ï∂îÍ∞Ä Ïπ¥Îìú ÎÇ¥Ïö© -->
                </div>
                <!-- ÌååÏùºÌï® ÏÉÅÏÑ∏ ÏãúÏûë -->
                <div class="card-body">
                  <c:forEach var="ganttVO" items="${ganttVOList}" end="3" varStatus="stat"> 
                    <c:if test="${ganttVO.proFileNo != null}">
                        <div class="callout callout-success" style=" display: flex; align-items: center; justify-content: space-between; padding: 16px; border-radius: 8px;">
													<div style="display: flex; flex-direction: column; gap: 4px;">
                          <h5>üìÅ${ganttVO.fileOriginalName}</h5>
                          <p>‚úîÌîÑÎ°úÏ†ùÌä∏ Î™Ö : ${ganttVO.proJobNm}</p>
												</div>

													<i class="fas fa-download imgFileSaveLocate" style="font-size: 24px; cursor:pointer;"  data-file-save-locate="${ganttVO.fileSaveLocate}"></i>
                        </div>
                      </c:if>
                  </c:forEach>
                </div>
                <!-- ÌååÏùºÌï® ÏÉÅÏÑ∏ ÎÅù -->
              </div>
            </div>
            <div class="col-md-12">
              <!-- ÎÑ§ Î≤àÏß∏ Ïπ¥Îìú -->
              <!-- <div class="card card-primary minHeight">
                <div class="card-header movePage" onclick="location.href = '/managepage/manage/empCalendar/${proNo}'">
                  <h3 class="card-title">Ï∫òÎ¶∞Îçî</h3>
                  <i class="fas fa-hand-pointer" style="margin-left: auto;"></i> -->
                  <!-- Ï∂îÍ∞Ä Ïπ¥Îìú ÎÇ¥Ïö© -->
                <!-- </div> -->
                <!-- <div id="Wrapper">
                  <div id='calendar'></div>
                </div> -->
              <!-- </div> -->
            </div>
          </div>
        </div>
    
        <!-- Ïò§Î•∏Ï™Ω Í∏¥ Ïπ¥Îìú(Îã¥ÎãπÏûê) -->
        <div class="col-md-4" >
          <div class="card card-secondary" style="min-height: 144vh;">
            <div class="card-header">
              <h3 class="card-title">Îã¥ÎãπÏûê</h3>
              <div class="card-tools">
              </div>
            </div>
              <form id="frm" action="/managepage/manage/updatePostAjax" method="post">
                <div class="card-body">
                  <!-- Îã¥ÎãπÏûê ÏòÅÏó≠ ÏãúÏûë -->
                    <div class="card">
                      <div class="card-header">
                        <h3 class="card-title">Ïù¥Î¶Ñ & Î∂ÄÏÑú</h3>
                        <div class="card-tools">

                          <button type="button" class="btn btn-tool" onclick="location.href='/managepage/manage/projectEmpList/${proNo}'">
                            <i class="fas fa-plus">&nbsp;&nbsp;Îã¥ÎãπÏûê Ï∂îÍ∞Ä</i>
                          </button>
                        </div>
                      </div>
                      <div class="card-body p-0">
                        <ul class="products-list product-list-in-card pl-2 pr-2">
                          <c:forEach var="proVO2" items="${projectVO2}" varStatus="stat">
                            <li class="item">
                              <div class="product-info">
                                <a href="javascript:void(0)" class="product-title" />${proVO2.memName}
                                <span class="product-description">
	                                ${proVO2.departName}
                                </span>
                              </div>
                            </li>
                          </c:forEach>
                        </ul>
                      </div>
                      <!-- /.card-footer -->
                    </div>
                  <!-- Îã¥ÎãπÏûê ÏòÅÏó≠ ÎÅù -->
                  <div class="form-group" style="display: none;">
                    <label for="proNo"><b>ÌîÑÎ°úÏ†ùÌä∏ Î≤àÌò∏</b></label>
                    <textarea id="proNo" name="proNo" class="form-control" rows="6" value="${projectVO.proNo}">${projectVO.proNo}</textarea>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    
  </section>
</main>
<!-- ///// content ÎÅù ///// -->

	
<!-- Ï∫òÎ¶∞Îçî Ïä§ÌÅ¨Î¶ΩÌä∏ ÏòÅÏó≠ -->
<script>
	// Ï†ÑÏó≠Î≥ÄÏàò
	/*
	const YrModal = document.querySelector("#yrModal");
	const calendarEl = document.querySelector('#calendar');
	const mySchStart = document.querySelector("#schStart");
	const mySchEnd = document.querySelector("#schEnd");
	const mySchTitle = document.querySelector("#schTitle");
	const mySchAllday = document.querySelector("#allDay");
	const mySchBColor = document.querySelector("#schBColor");
	const mySchFColor = document.querySelector("#schFColor");
	// Ï∫òÎ¶∞Îçî ÌäπÏ†ï Ï£ºÏÜå Î¶¨Ïä§Ìä∏
	const calList = `${projectVO.proNo}`;
	console.log("Ï∫òÎ¶∞Îçî ÌäπÏ†ï Ï£ºÏÜå Î¶¨Ïä§Ìä∏(calList) : ", calList);

	// DBÌÜµÏã† ÌõÑ Ï∫òÎ¶∞Îçî Îç∞Ïù¥ÌÑ∞
	const respDataArr = [];
	function respDataList(respData){
		// console.log("ÎÇòÏò§Îãù?(respData) : ", respData);
		respData.forEach(e => {
			// console.log("Î∞òÎ≥µÎ¨∏(e) : ", e);
			respDataArr.push(e);
		});
		// var respDataJSON = JSON.stringify(respDataArr);
		// console.log("Ïó¨Í∏∞ÏÑú ÎÇòÏôÄÏïº Îèº(respDataJSON) : ", respDataJSON);
		calendarSijax(respDataArr);
	}
	
function calendarSijax(respDataArr){
	console.log("Ï∫òÎ¶∞Îçî Ìò∏Ï∂ú ÏΩúÎ∞±", respDataArr);
	

	//Ï∫òÎ¶∞Îçî Ìó§Îçî ÏòµÏÖò
	const headerToolbar = {
			left: 'prevYear,prev,next,nextYear today',
			center: 'title',
			right: 'dayGridMonth,dayGridWeek,timeGridDay'
	}

	// Ï∫òÎ¶∞Îçî ÏÉùÏÑ± ÏòµÏÖò(Ï∞∏Í≥µ)
	const calendarOption = {
		// Ï∫òÎ¶∞Îçî Í≤πÏπòÎäî ÏöîÏÜå Î™®Îëê Î≥¥Ïù¥Í∏∞
		dayMaxEvents: false,
		height: '700px', // calendar ÎÜíÏù¥ ÏÑ§Ï†ï
		expandRows: true, // ÌôîÎ©¥Ïóê ÎßûÍ≤å ÎÜíÏù¥ Ïû¨ÏÑ§Ï†ï
		slotMinTime: '09:00', // Day Ï∫òÎ¶∞Îçî ÏãúÏûë ÏãúÍ∞Ñ
		slotMaxTime: '18:00', // Day Ï∫òÎ¶∞Îçî Ï¢ÖÎ£å ÏãúÍ∞Ñ
		// Îß® ÏúÑ Ìó§Îçî ÏßÄÏ†ï
		headerToolbar: headerToolbar,
		initialView: 'dayGridMonth',  // default: dayGridMonth 'dayGridWeek', 'timeGridDay', 'listWeek'
		locale: 'kr',        // Ïñ∏Ïñ¥ ÏÑ§Ï†ï
		selectable: true,    // ÏòÅÏó≠ ÏÑ†ÌÉù
		selectMirror: true,  // Ïò§ÏßÅ TimeGrid viewÏóêÎßå Ï†ÅÏö©Îê®, default false
		navLinks: true,      // ÎÇ†Ïßú,WeekNumber ÌÅ¥Î¶≠ Ïó¨Î∂Ä, default false
		weekNumbers: true,   // WeekNumber Ï∂úÎ†•Ïó¨Î∂Ä, default false
		editable: true,      // event(ÏùºÏ†ï) 
		*/
		/* ÏãúÏûëÏùº Î∞è Í∏∞Í∞Ñ ÏàòÏ†ïÍ∞ÄÎä•Ïó¨Î∂Ä
		eventStartEditable: false,
		eventDurationEditable: true,
		*/
		// dayMaxEventRows: true,  // Row ÎÜíÏù¥Î≥¥Îã§ ÎßéÏúºÎ©¥ +Ïà´Ïûê more ÎßÅÌÅ¨ Î≥¥ÏûÑ!
		/*
		views: {
				dayGridMonth: {
						dayMaxEventRows: 3
				}
		},
		nowIndicator: true,

		//events:[],
		// Ïù¥Í≥≥Ïóê CRUD ÌïòÎ©¥ Îê®
		eventSources: [
			respDataArr
		]
	}

	// Ï∫òÎ¶∞Îçî ÏÉùÏÑ±
	const calendar = new FullCalendar.Calendar(calendarEl, calendarOption);
	
	// Ï∫òÎ¶∞Îçî Í∑∏Î¶¨ÍπÖ
	calendar.render();

	// Ï∫òÎ¶∞Îçî Ïù¥Î≤§Ìä∏ Îì±Î°ù
	calendar.on("eventAdd", info => console.log("Add:", info));
	calendar.on("eventChange", info => console.log("Change:", info));
	calendar.on("eventRemove", info => console.log("Remove:", info));
	calendar.on("eventClick", info => {
			console.log("eClick:", info);
			console.log('Event: ', info.event.extendedProps);
			console.log('Coordinates: ', info.jsEvent);
			console.log('View: ', info.view);
			// Ïû¨ÎØ∏Î°ú Í∑∏ÎÉ• Î≥¥ÎçîÏÉâ Î∞îÍæ∏ÍπÖ
			info.el.style.borderColor = 'red';
	});
	calendar.on("eventMouseEnter", info => console.log("eEnter:", info));
	calendar.on("eventMouseLeave", info => console.log("eLeave:", info));
	calendar.on("dateClick", info => console.log("dateClick:", info));
	calendar.on("select", info => {
			console.log("Ï≤¥ÌÇÅ:", info);

			mySchStart.value = info.startStr;
			mySchEnd.value = info.endStr;

			YrModal.style.display = "block";
	});

	// ÏùºÏ†ï(Ïù¥Î≤§Ìä∏) Ï∂îÍ∞ÄÌïòÍπÖ
	function fCalAdd() {
			if (!mySchTitle.value) {
					alert("Ï†úÎ™®Í≤å Î®∏ÎùºÎèÑ Ïç®Ï£ºÏÇº")
					mySchTitle.focus();
					return;
			}
			let bColor = mySchBColor.value;
			let fColor = mySchFColor.value;
			if (fColor == bColor) {
					bColor = "black";
					fColor = "yellow";
			}

			let event = {
					start: mySchStart.value,
					end: mySchEnd.value,
					title: mySchTitle.value,
					// allDay: mySchAllday.checked,
					backgroundColor: bColor,
					textColor: fColor
			};

			calendar.addEvent(event);
			fMClose();
	}

	// Î™®Îã¨ Îã´Í∏∞
	function fMClose() {
			YrModal.style.display = "none";
	}

	// function asdf(asdf){
	// 	console.log("Ï≤¥ÌÇÅ : ", asdf);
	// }
}	

	// Ï∫òÎ¶∞Îçî Ï†ÑÏ≤¥ Î¶¨Ïä§Ìä∏
	async function getEmpCalendar() {

		let data = {
			"id" : calList
		}
		// console.log("ajaxÏóê ÎÑòÍ∏∏ Îç∞Ïù¥ÌÑ∞(data) : ", data);

		// ÏµúÏ¥à Ï†ÑÏ≤¥ Ï∫òÎ¶∞Îçî Îç∞Ïù¥ÌÑ∞
		let resp = await axios.post("/managepage/manage/getEmpCalendar", data ,{
			headers: {
				"Content-Type": "application/json",
			}
		});
		// console.log("ÏµúÏ¥à Ï†ÑÏ≤¥ Ï∫òÎ¶∞Îçî Îç∞Ïù¥ÌÑ∞ : ", resp.data);
		// respData = resp.data
		var respData = resp.data;
		// console.log("json Î≥ÄÏàòÏóê Îã¥Í∏∞(respData) : ", respData);
		
		respDataList(respData); // ‚Üê‚Üê respDataÎ•º Ïó¨Í∏∞Ïóê ÏßëÏñ¥ÎÑ£Ïñ¥ÏÑú ÏΩúÎ∞±ÏúºÎ°ú ÎÅåÍ≥† Îã§ÎãàÍ∏∞
	}
	// ÏµúÏ¥à Î¶¨Ïä§Ìä∏ Ìò∏Ï∂ú
	getEmpCalendar();
	// Ï∫òÎ¶∞Îçî Ìò∏Ï∂ú
	// calendarSijax();

	// ÌäπÏ†ï Ï£ºÏÜå Ï∫òÎ¶∞Îçî Í∞ÄÏ†∏Ïò§Í∏∞
	// function getOneCal() {
		
	// }
	*/
</script>
 

<!-- ///// footer ÏãúÏûë ///// -->
<jsp:include page="../../include/footer.jsp"></jsp:include>
<!-- ///// footer ÎÅù ///// -->